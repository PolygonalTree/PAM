var child = require('child_process');
var shell = require('shelljs');
var fs = require('fs');
var path = require('path');

var Management = function(){

    function initWorkspace(){
        shell.mkdir('-p', process.env.HOME+'/.virtualenv');
        shell.mkdir('-p', process.env.HOME+'/Devel');
        process.env.WORKON_HOME=process.env.HOME+'/.virtualenv';
        process.env.PROJECT_HOME=process.env.HOME+'/Devel';
        console.log(process.env);
       }

    function install(appSource, appName, pythonVersion){
        var installSh = child.spawn('sh',['App_installer.sh', appSource, appName,pythonVersion],{
                            cwd: './scripts',
                            env: process.env
                        });
        installSh.stdout.on('data', function (data) {
            console.log('ps out: '+data);
        });

        installSh.stderr.on('data', function (data) {
            console.log('ps stderr: ' + data);
        });
    }

    function uninstall(appName){
        var installSh = child.spawn('sh',['App_uninstaller.sh',appName],{
                            cwd: './scripts',
                            env: process.env
                        });
    }

    function launch(appName){
        var launchedApp = child.spawn('sh',['App_launcher.sh',appName],{
                            cwd: './scripts',
                            env: process.env
                        });
        launchedApp.stdout.on('data', function (data) {
            console.log('ps out: '+data);
        });

        launchedApp.stderr.on('data', function (data) {
            console.log('ps stderr: ' + data);
        });

        return launchedApp;
    }

    function listOfApps(){
        var appObj={}
        var list = fs.readdirSync(process.env.WORKON_HOME)
        for (index in list){
            var appName = list[index];
            appObj[appName]={'name':appName,
                         'icon':path.join(process.env.PROJECT_HOME,appName,'/img/icon.ico')
                        }
        }
        return appObj;
    }

    this.install = install;
    this.uninstall = uninstall;
    this.launch = launch;
    this.initWorkspace = initWorkspace;
    this.listOfApps = listOfApps;

}
module.exports = new Management;
